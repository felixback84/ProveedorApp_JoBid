var getHash = function(hash) {
  if (!hash.length) {
    return {};
  }
  if (hash.substring(0, 1) !== '#') {
    alert('ERROR: Bad URL.\n\nPlease close this window, open a new tab and type the URL of the app again.');
    return {};
  }
  var query = hash.substring(1);
  var vars = query.split('&');
  var res = {};
  for (var i = 0; i < vars.length; i++) {
    var pair = vars[i].split('=');
    var key = decodeURIComponent(pair[0]);
    if (typeof res[key] !== 'undefined') {
      alert('ERROR: "'+key+'" appears twice in the query string.\n\nPlease close this window, open a new tab and type the URL of the app again.');
    } else {
      res[key] = decodeURIComponent(pair[1]);
    }
  }
  return res;
};


var saveHash = function(state) {
  var hash = '#'
  for (var key in state) {
    if (key && state.hasOwnProperty(key)) {
      if (hash === '#') {
        hash += key+'='+state[key];
      } else {
        hash += '&'+key+'='+state[key];
      }
    }
  }
  return hash;
};


module.exports = {
  getHash: getHash,
  saveHash: saveHash,
};
